<html>
    <head>
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/0.3.9/peer.min.js"></script>
    </head>
    <body>
        <div id="joinordie">
            Join a game or host a game.
            <br>
            <button id="Join" type="button">Join</button>
            <button id="Host" type="button">Host</button>
        </div>
        <div id="joining" hidden="true">
            Enter code:
            <input type="text" id="codeEntry">
            <button id="enterCode" type="button">Join</button>
        </div>
        <div id="hosting" hidden="true">
            Remember this code:
            <input type="text" id="codeOut" disabled>
        </div>
        <div id="rps_buttons" hidden="true">
            <button type="button" disabled>Rock</button>
            <button type="button" disabled>Paper</button>
            <button type="button" disabled>Scissors</button><!-->
            <input type="text" id="chat">
            <button type="button" id="cat">Send</button>
            <p id="cha"></p><!--bob-->
        </div>
        <script>
            var peer = new Peer();
            var dataConnection = null;
            var joinGame = function() {
                document.getElementById('joinordie').hidden = true;
                document.getElementById('joining').hidden = false;
            }
            var hostGame = function() {
                document.getElementById('joinordie').hidden = true;
                document.getElementById('hosting').hidden = false;
            }
            var sendstuff = function() {
                dataConnection.send(document.getElementById('chat').value);
                var it = document.getElementById('cha').innerText;
                document.getElementById('cha').innerText = 'You said: '+document.getElementById('chat').value+'\n'+it;
                document.getElementById('chat').value = '';
            }
            var ondc = function() {
                dataConnection.on('data',function(d) {
                    var it = document.getElementById('cha').innerText;
                    document.getElementById('cha').innerText = 'They said: '+d+'\n'+it;
                });
                document.getElementById('cat').addEventListener('click',sendstuff);
            }
            var readCode = function() {
                dataConnection = peer.connect(document.getElementById('codeEntry').value);
                document.getElementById('joining').hidden = true;
                document.getElementById('rps_buttons').hidden = false;
                dataConnection.on('open',ondc);
            }
            document.getElementById('Join').addEventListener('click',joinGame);
            document.getElementById('Host').addEventListener('click',hostGame);
            document.getElementById('enterCode').addEventListener('click',readCode);
            document.getElementById('codeEntry').addEventListener('keyup',function(k) {
                if (k.keyCode === 13) {
                    document.getElementById('enterCode').click();
                }
            });
            document.getElementById('chat').addEventListener('keyup',function(k) {
                if (k.keyCode === 13) {
                    document.getElementById('cat').click();
                }
            });
            peer.on('open',function(id) {
                document.getElementById('codeOut').value = id;
            });
            peer.on('connection',function(dc) {
                dataConnection = dc;
                document.getElementById('hosting').hidden = true;
                document.getElementById('rps_buttons').hidden = false;
                dataConnection.on('open',ondc);
            });
            peer.on('error',function(err) {
                alert(''+err);
            });
        </script>
    </body>
</html>
